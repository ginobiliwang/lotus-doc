<!doctype html>
<html>
<head>
  <meta charset="utf-8">

  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      Lotus Introduction

  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="../../../../stylesheets/master.css" rel="stylesheet" media="screen,print" />
  <link href="../../../../stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='../../../../images/favicon.ico' rel='shortcut icon'>
  <script src="../../../../javascripts/all.js"></script>

  <script type="text/javascript">
    if (window.location.host === 'localhost:9292') {
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-39702075-1']);
      _gaq.push(['_setDomainName', 'pivotal.io']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
"./index1.html" 224L, 9289C
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    }
  </script>
</head>

<body class="x4360 x4360_client_tool_guides x4360_client_tool_guides_load x4360_client_tool_guides_load_unix x4360_client_tool_guides_load_unix_gpfdist has-subnav">

<div class="viewport">
<div class='wrap'>
  <script src="https://use.typekit.net/clb0qji.js" type="text/javascript"></script>
  <script type="text/javascript">
      try {
          Typekit.load();
      } catch (e) {
      }
  </script>
  <script type="text/javascript">
      document.domain = "pivotal.io";
  </script>

  <script type="text/javascript">
    WebFontConfig = {
      google: { families: [ 'Source+Sans+Pro:300italic,400italic,300,400,600:latin' ] }
    };
    (function() {
      var wf = document.createElement('script');
      wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      var wf = document.createElement('script');
      wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
        '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
      wf.type = 'text/javascript';
      wf.async = 'true';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(wf, s);
    })();
  </script>

    <header class="header header-layout">
      <h1 class="logo">
        Lotus Documentation
      </h1>
    </header>

  <div class="container">

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>

  <div class="body">


    <div class="section" id="topic1__section3">
<h2 class="title sectiontitle">Description</h2>

      <p class="p"><samp class="ph codeph">lotus</samp> is a high speed web server that serves data files to Greenplum Databases.</p>
      <p class="p"><samp class="ph codeph"><a href="https://ginobiliwang.github.io/lotus-doc/aster.html">aster</a></samp> is a streaming server that works together with <samp class="ph codeph">lotus</samp>.</p>

<h2 class="title sectiontitle">Release</h2>

      <p class="p"><samp class="ph codeph"><a href="https://ginobiliwang.github.io/lotus-doc/release.html">Download latest release.</a></samp> </p>

    <div class="section" id="topic1__section2">
<h2 class="title sectiontitle">Synopsis</h2>


<pre class="pre codeblock"><strong class="ph b">lotus --help</strong></pre>

    </div>
<h3 class="title sectiontitle">Highlight</strong></h3>
      <div class="note note">

<span class="notetitle">1. </span> <strong class="ph b">Preactor pattern.</strong></div>
<span class="notetitle">2. </span> <strong class="ph b">Based on Libevent library.</strong></div>
<span class="notetitle">3. </span> <strong class="ph b">Memory pool for memory consumption.</strong></div>
<span class="notetitle">4. </span> <strong class="ph b">Configurable Thread pool for multithread.</strong></div>
<span class="notetitle">5. </span> <strong class="ph b">Zero copy to efficiently transfer data.(Optional)</strong></div>
<span class="notetitle">6. </span> <strong class="ph b">Implement using C++/C language.</strong></div>
<span class="notetitle">7. </span> <strong class="ph b">Implement gpfist protocol, could work with greenplum database.</strong></div>
<span class="notetitle">8. </span> <strong class="ph b">Use ZSTD as compression tool for data transfer, can surpass physical network capacity.</strong></div>



      <p class="p">The advantage of using <samp class="ph codeph">lotus</samp> is that it is built up with modern web architecture <a href="http://www.kegel.com/c10k.html">c10k problem</a>. It enables <samp class="ph codeph">lotus</samp> to be easy to deal with complicated reqiurements. It is more configurable, adaptable and faster comparing with the gpfdist.</p>
      
      <p class="p">Beside its performance, it could be easily integrated with message bus like Kafka/RabbitMQ or with data streaming server like Flink.</p>
      
      <p class="p">We have also developed streaming server, which has been released along with <samp class="ph codeph">lotus</samp>. The streaming server could ingest records/messages from Kafak/Rabbitmq and log agent like  <a href="https://fluentbit.io/documentation">fluent-bit</a>. Information from all these parties could be aggregated together and then fed into Greenplum database. There is demo at the bottom of the page.</p>

      
      <p class="p"><samp class="ph codeph">lotus</samp> could replace the old tool called  <a href="https://gpdb.docs.pivotal.io/6-3/utility_guide/ref/gpfdist.html">gpfdist</a> which is single thread and non-configurable web architecture. 

      <p class="p">For readable external tables, <samp class="ph codeph">lotus</samp> split data file and serves data cocurrently to all the segment instances in the Greenplum Database system when users
          <samp class="ph codeph">SELECT</samp> from the external table. </p>
      
      <p class="p">For streaming server <a href="https://ginobiliwang.github.io/lotus-doc/aster.html">aster</a> working with Kafka/RabbitMQ/Fluent-bit it would be released together with <samp class="ph codeph">lotus</samp>.</p>


<strong class="ph b">Hint</strong></pre>
      <p class="p">When you have turned on Zero copy feature in <samp class="ph codeph">lotus</samp>, please carefully tune accordingly parameters like thread_num or split_size, sometimes data copy speed could be even worse when mis-configuration happen.</p>
      
      <p class="p">Anyway, zero copy feature could reduce context change and would bring performace enhancement.</p>


      <p class="p">When you have turned on ZSTD feature in <samp class="ph codeph">lotus</samp>, you need to add an entry in the external table ddl, things like this "Command: sh /tmp/gcurl.sh smdw:8081/dev/shm/lotus.txt". With such script, data stream IO on each segment would be redirected to the script itself. In the script, it is primarily a curl command with special http headers and unzstd command in linux pipe.</p>
      
      <p class="p">A sample script has been shipped together with lotus binary from version 1.1.0.</p>


    <div class="section" id="topic1__section4">
<h2 class="title sectiontitle">Options</h2>
      
     <dl class="dl parml">
        
      <dt class="dt pt dlterm"> -v: display version<var class="keyword varname"></var>
</dt>
    
      <dt class="dt pt dlterm"> -d: [optional] working directory, default is '/tmp/' <var class="keyword varname"></var>
</dt>
     
      <dt class="dt pt dlterm"> -p: [required] listening port <var class="keyword varname"></var>
</dt>

            
      <dt class="dt pt dlterm"> -h: [required] listening host ip <var class="keyword varname"></var>
</dt>
          
      <dt class="dt pt dlterm"> -m: [optional] slice size for each file split, default is '524288' <var class="keyword varname"></var>
</dt>
	
      <dt class="dt pt dlterm"> -n: [optional] thread pool number, default is '32' <var class="keyword varname"></var>
</dt>
	 
      <dt class="dt pt dlterm"> -s: [optional] number of sub reactors, default is '4' <var class="keyword varname"></var>
</dt>  

      <dt class="dt pt dlterm"> -z: [optional] enable zstd for compression, default is 'false' <var class="keyword varname"></var>
</dt>  
      </dl>

    </div>

    <div class="section" id="topic1__section6">
<h2 class="title sectiontitle">Demos</h2>
      
<iframe width="360" height="215" src="https://www.youtube.com/embed/vrLfJ7BcNXY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
	   <div><a href="https://www.bilibili.com/video/BV1nQ4y1K7ro/">Video demo for people can NOT visit Youtube</a></div>
    
<div class="section" id="topic1__section7">
<h2 class="title sectiontitle">Benchmark</h2>
      <p class="p">The main bottleneck for servers like lotus or gpfdist is the IO.Benchmark has been done with memory-mapped file which could be considered as high speed, so bottleneck is primarily from network card.</p><p class="p"> We have two 1000gb network cards, and one 10000gb network card. For lotus, just listening on 0.0.0.0, all the network cards would have 100% workload if there is no other bottlenecks. Below is the statistics.</p>
 <table  border=1>
        <caption>Benchmark between lotus and gpfdsit</caption>
        <tr>
          <td> </td>
          <td>Time cost</td>
          <td>Number of segments in gpdb</td>
          <td>Number of records</td>
          <td>Size of records</td>
        </tr>
        <tr>
          <td>gpfdist</td>
          <td>24 seconds</td>
          <td>192</td>
          <td>300,303,000</td>
          <td>37GB</td>
        </tr>
        <tr>
          <td>lotus</td>
          <td>16.85 seconds</td>
          <td>192</td>
          <td>300,303,000</td>
          <td>37GB</td>
        </tr>
        </table>	    
 
      <p class="p">The top speed for typical physical nic of 10000Gbps is about 10000/1.024/1.024/8=1192.0928955078 MB per second, so we can get that the time span to consume 11GB data is 11*1024/1192 = 9.4496644  seconds.</p>

      <p class="p"> We have used only one 10000Gbps network card to do the benchmark, when ZSTD compression is on, time comsuption is around 3.2 seconds that is 3 times faster than full speed of the nic in traditional way.  Below is the statistics.</p>
<table  border=1>
        <caption>Benchmark with ZSTD is on for lotus</caption>
        <tr>
          <td> </td>
          <td>Time cost</td>
          <td>Number of segments in gpdb</td>
          <td>Number of records</td>
          <td>Size of records</td>
        </tr>
        <tr>
          <td>lotus</td>
          <td>3182.563 milliseconds</td>
          <td>64</td>
          <td>89,000,000</td>
          <td>11GB</td>
        </tr>
        </table>	    
</div>
	    
<div class="section" id="topic1__section7">
<h2 class="title sectiontitle">See Also</h2>
      
      <p class="p"><a href="https://gpdb.docs.pivotal.io/6-3/utility_guide/ref/gpfdist.html">gpfdist</a>.</p>
    </div>

  </div>



      </main><!--end of content-->

  </div><!-- end of container -->

  <script type="text/javascript">
    (function() {
      var didInit = false;
      function initMunchkin() {
        if(didInit === false) {
          didInit = true;
          Munchkin.init('625-IUJ-009');
        }
      }
      var s = document.createElement('script');
      s.type = 'text/javascript';
      s.async = true;
      s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
      s.onreadystatechange = function() {
        if (this.readyState == 'complete' || this.readyState == 'loaded') {
          initMunchkin();
        }
      };
      s.onload = initMunchkin;
      document.getElementsByTagName('head')[0].appendChild(s);
    })();
  </script>
</div><!--end of wrap-->
</div><!--end of viewport-->


</body>
</html>
